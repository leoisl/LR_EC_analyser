#Running gmap:
#How we built the index
gmap_build -D /data2/ASTER/nanopore_mouse/Our_mapping_to_mRNA_only/gmap_genome -d GRCm38 /data2/ASTER/nanopore_mouse/genomic_data/Mus_musculus.GRCm38.dna.primary_assembly.fa

#mapping
GMAP_GENOME_DIR=/data2/ASTER/nanopore_mouse/Our_mapping_to_mRNA_only/gmap_genome
GMAP_GENOME_NAME=GRCm38
gmap -D $GMAP_GENOME_DIR -d $GMAP_GENOME_NAME -n 10 -t $THREADS -f samse $RAW_READS_FILE >  ${OUTPUT_PREFIX}.gmap.sam

#from sam to bam
samtools view -S -o ${OUTPUT_PREFIX}.gmap.bam ${OUTPUT_PREFIX}.gmap.sam
rm ${OUTPUT_PREFIX}.gmap.sam


#Running minimap2:
GENOME_PATH=/data2/ASTER/nanopore_mouse/genomic_data/Mus_musculus.GRCm38.dna.primary_assembly.fa
minimap2 -ax splice $GENOME_PATH $RAW_READS_FILE > ${OUTPUT_PREFIX}.minimap2.sam

#from sam to bam
samtools view -S -o ${OUTPUT_PREFIX}.minimap2.bam ${OUTPUT_PREFIX}.minimap2.sam
rm ${OUTPUT_PREFIX}.minimap2.sam





#command-line to run LR_EC_analyser and compare both mappers:
source venv/bin/activate
python /data2/ASTER/error_correction/LR_EC_analyser/run_LR_EC_analyser.py --genome /data2/ASTER/nanopore_mouse/genomic_data/Mus_musculus.GRCm38.dna.primary_assembly.fa --gtf /data2/ASTER/nanopore_mouse/transcriptomic_data/Mus_musculus.GRCm38.87.gtf -o gmap_vs_minimap2/output -t 8 --paralogous /data2/ASTER/nanopore_mouse/transcriptomic_data/Mus_musculus.GRCm38.87.paralog_genes.80_percent_plus_identity.txt --raw /data2/ASTER/error_correction/raw_1D_only_data_no_mito_no_rDNA/gmap_bam/raw.gmap.bam --self /data2/ASTER/error_correction/raw_1D_only_data_no_mito_no_rDNA/minimap2_bam/raw.minimap2.bam
#if needed to re-run, add the skips:
python /data2/ASTER/error_correction/LR_EC_analyser/run_LR_EC_analyser.py --genome /data2/ASTER/nanopore_mouse/genomic_data/Mus_musculus.GRCm38.dna.primary_assembly.fa --gtf /data2/ASTER/nanopore_mouse/transcriptomic_data/Mus_musculus.GRCm38.87.gtf -o gmap_vs_minimap2/output -t 8 --paralogous /data2/ASTER/nanopore_mouse/transcriptomic_data/Mus_musculus.GRCm38.87.paralog_genes.80_percent_plus_identity.txt --raw /data2/ASTER/error_correction/raw_1D_only_data_no_mito_no_rDNA/gmap_bam/raw.gmap.bam --self /data2/ASTER/error_correction/raw_1D_only_data_no_mito_no_rDNA/minimap2_bam/raw.minimap2.bam --skip_bam_process --skip_alignqc --skip_copying
deactivate
